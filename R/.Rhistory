}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")) {
if (dotOccurence[[1]] > playerIndex) {
dotIndex <- dotOccurence[[1]]
print(dotIndex)
}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")) {
if (dotOccurence[[1]] < playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")) {
print(dotOccurence[[1]])
print(dotIndex)
print(playerIndex)
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
print(str_locate_all(comment, "[.]"))
for (dotOccurence in str_locate_all(comment, "[.]")) {
print(dotOccurence[[1]])
print(dotIndex)
print(playerIndex)
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")[[1]]) {
print(dotOccurence[[1]])
print(dotIndex)
print(playerIndex)
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")[[1]]) {
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
findFirstDotAfterPlayer("Want to re-think the whole Jim Zorn hire, Daniel Snyder? I've never seen a team more unprepared for an NFL game than the Redskins. They showed no sense of urgency at the end of the game, and Zorn looked like he didn't even know what a 2.minute offense was. I can't say I'm surprised though, as this is coming from an owner who frivolously overspends on 40-year-old has-beens and hires idiots like Vinny Cerrato to manage the team. Cerrato couldn't even stay awake for this game! For more on this, see my . Believe me, I'll have more on Zorn in the coming weeks. For those of you who missed this game, Clinton Portis was actually telling Zorn which plays to run on the sideline. Later in the evening, after the Redskins were contained to their 800th 3.and-out, Portis slammed his helmet down in frustration. I can't blame him. On the bright side, it can only get easier, as the Giants are 1 of the top teams in the league. Clinton Portis was the only productive Redskins offensive player until the 4.h quarter. He had 84 yards on 23 carries. Antwaan Randle El picked it up in garbage time, snatching 7 catches for 73 yards. Santana Moss chipped in with 37 yards and a touchdown on 5 receptions. Jason Campbell was pretty brutal. He completed his first pass with 1 minute remaining in the second quarter! He finished 15-of-27 for 133 yards and a score, giving him a discouraging YPA of 4.9. He did his best impression of Trent Green, often throwing short on third downs. However, 1 could argue that Campbell would have been responsible for a couple of interceptions if he went deep. Looks like it's going to take Campbell much longer to learn the West Coast offense than optimistic Redskins fans had hoped. The Giants won, but I wasn't too convinced by their victory. They jumped out on the Redskins early with a 16-0 lead, but stalled multiple times at midfield afterward. Following a hot start, Eli Manning was errant on many of his passes. He had a pick, but he could have easily thrown 3. Brandon Jacobs and Plaxico Burress were the stars for the Giants. Jacobs rumbled for 116 yards on 21 carries, while Burress caught 10 balls for 133 yards, completely torching corner Fred Smoot, who had to leave the game in the second half with a bruised ego.", 1905)
library(stringr)
library(rjson)
# Function extracts all numbers from given text
numExtract <- function(string) {
allNumbers <- regmatches(string, gregexpr("[[:digit:]]+", string))
allNumbers <- as.numeric(unlist(allNumbers))
allNumbers <- as.list(strsplit(toString(allNumbers), ", ")[[1]])
return(allNumbers)
}
#Replace all numbers (from one to ten) that occur as string as integer
numReplace <- function(text) {
numbersList <- list(
list(" one ", " 1 "),
list(" two ", " 2 "),
list(" three ", " 3 "),
list(" four ", " 4 "),
list(" five ", " 5 "),
list(" six ", " 6 "),
list(" seven ", " 7 "),
list(" eight ", " 8 "),
list(" nine ", " 9 "),
list(" ten ", " 10 "),
list("[(]one ", "(1 "),
list("[(]two ", "(2 "),
list("[(]three ", "(3 "),
list("[(]four ", "(4 "),
list("[(]five ", "(5 "),
list("[(]six ", "(6 "),
list("[(]seven ", "(7 "),
list("[(]eight ", "(8 "),
list("[(]nine ", "(9 "),
list("[(]ten ", "(10 "),
list(" one[)]", " 1)"),
list(" two[)]", " 2)"),
list(" three[)]", " 3)"),
list(" four[)]", " 4)"),
list(" five[)]", " 5)"),
list(" six[)]", " 6)"),
list(" seven[)]", " 7)"),
list(" eight[)]", " 8)"),
list(" nine[)]", " 9)"),
list(" ten[)]", " 10)"),
list(" one.", " 1."),
list(" two.", " 2."),
list(" three.", " 3."),
list(" four.", " 4."),
list(" five.", " 5."),
list(" six.", " 6."),
list(" seven.", " 7."),
list(" eight.", " 8."),
list(" nine.", " 9."),
list(" ten.", " 10."))
for (numberName in numbersList) {
text <- gsub(numberName[[1]], numberName[[2]], text)
}
return(text)
}
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")[[1]]) {
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
weeks <- list("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20")
years <- list("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
years <- list("2008")
weeks <- list("01")
# Creating the Folders if not exists
path <- "..\\Data\\Output\\"
if (!(dir.exists(path))){
dir.create(path)
}
for (year in years) {
for (week in weeks) {
path <- paste(c("..\\Data\\Output\\", year), collapse = "")
if (!(dir.exists(path))){
dir.create(path)
}
}
}
id <- 1
for (year in years) {
for (week in weeks) {
weekFile <- paste(c("..\\Data\\RMoreInformation\\", year, "\\week_", week, ".json"), collapse = "") # File with the information of the game
if (file.exists(weekFile)) {
resultWeek <- rjson::fromJSON(file = weekFile)
i <- 1 # For iteration purpose
for (game in resultWeek$games) {
game$comments <- numReplace(game$comments)
resultWeek$games[[i]]$comments <- game$comments
j <- 1
if (length(game$players) > 1){ # Games which doesn't have any players are filtered here
for (player in game$players) {
playerInformation <- player$`game information` # Get the detailed information of the player for this game
properties <- paste(names(playerInformation), playerInformation)
playerComment <- "" # All parts in the comment belonging to the player
for (tempCurrentPlayerOccurence in str_locate_all(game$comments, player$`player information`$name)) { # If a player occurs more than once in a comment, we have to find all belonging parts
firstOccurenceOfOtherPlayerInText <- str_length(game$comments) # Upper bound
for (playerTemp in game$players) { # For all players in the comment
playerOccurenceInText <- str_locate_all(game$comments, playerTemp$`player information`$name) # All occurences of the current player in the comment
for (occurenceIndex in playerOccurenceInText) {
if (firstOccurenceOfOtherPlayerInText > occurenceIndex[[1]] && occurenceIndex[[1]] > tempCurrentPlayerOccurence[[2]]) { # If the position of the temp player is between the current player and the current upper bound we change the upper bound
firstOccurenceOfOtherPlayerInText <- occurenceIndex[[1]] - 1 # Char position before the temp player
}
}
}
endOfPlayerSentence <- findFirstDotAfterPlayer(game$comments, tempCurrentPlayerOccurence[[2]])
print(player$`player information`$name)
print(firstOccurenceOfOtherPlayerInText)
print(endOfPlayerSentence)
if (endOfPlayerSentence > firstOccurenceOfOtherPlayerInText) {
firstOccurenceOfOtherPlayerInText <- endOfPlayerSentence
}
playerComment <- paste(c(playerComment, substr(game$comments, tempCurrentPlayerOccurence[[1]], firstOccurenceOfOtherPlayerInText)), collapse="") # The belonging comment part
print(playerComment)
}
numbers <- numExtract(playerComment) # Get numbers from text
# Check for each number if it occurs in the statistics of the player
for (number in numbers) {
for (property in properties) {
propertyName <- strsplit(property, "[[:space:]]")[[1]][1]
propertyValue <- strsplit(property, "[[:space:]]")[[1]][2]
if (number == propertyValue) {
if (number != 0) {
playerInformation[[propertyName]] <- list(propertyValue, id) # Add marker and unique ID for annotation, if match is found
names(playerInformation[[propertyName]]) <- c("propertyValue", "annotationID")
id <- id + 1
}
}
}
}
resultWeek$games[[i]]$players[[j]]$`game information` <- playerInformation
j <- j + 1
}
}
i <- i + 1
}
exportJSON <- rjson::toJSON(resultWeek, 1) # Generate JSON
fileName <- paste(c("..\\Data\\Output\\", year, "\\week_", week, ".json"), collapse = "")
write(exportJSON, fileName) # Save JSON to file
}
}
}
library(stringr)
library(rjson)
# Function extracts all numbers from given text
numExtract <- function(string) {
allNumbers <- regmatches(string, gregexpr("[[:digit:]]+", string))
allNumbers <- as.numeric(unlist(allNumbers))
allNumbers <- as.list(strsplit(toString(allNumbers), ", ")[[1]])
return(allNumbers)
}
#Replace all numbers (from one to ten) that occur as string as integer
numReplace <- function(text) {
numbersList <- list(
list(" one ", " 1 "),
list(" two ", " 2 "),
list(" three ", " 3 "),
list(" four ", " 4 "),
list(" five ", " 5 "),
list(" six ", " 6 "),
list(" seven ", " 7 "),
list(" eight ", " 8 "),
list(" nine ", " 9 "),
list(" ten ", " 10 "),
list("[(]one ", "(1 "),
list("[(]two ", "(2 "),
list("[(]three ", "(3 "),
list("[(]four ", "(4 "),
list("[(]five ", "(5 "),
list("[(]six ", "(6 "),
list("[(]seven ", "(7 "),
list("[(]eight ", "(8 "),
list("[(]nine ", "(9 "),
list("[(]ten ", "(10 "),
list(" one[)]", " 1)"),
list(" two[)]", " 2)"),
list(" three[)]", " 3)"),
list(" four[)]", " 4)"),
list(" five[)]", " 5)"),
list(" six[)]", " 6)"),
list(" seven[)]", " 7)"),
list(" eight[)]", " 8)"),
list(" nine[)]", " 9)"),
list(" ten[)]", " 10)"),
list(" one.", " 1."),
list(" two.", " 2."),
list(" three.", " 3."),
list(" four.", " 4."),
list(" five.", " 5."),
list(" six.", " 6."),
list(" seven.", " 7."),
list(" eight.", " 8."),
list(" nine.", " 9."),
list(" ten.", " 10."))
for (numberName in numbersList) {
text <- gsub(numberName[[1]], numberName[[2]], text)
}
return(text)
}
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")[[1]]) {
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
weeks <- list("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20")
years <- list("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
years <- list("2008")
# Creating the Folders if not exists
path <- "..\\Data\\Output\\"
if (!(dir.exists(path))){
dir.create(path)
}
for (year in years) {
for (week in weeks) {
path <- paste(c("..\\Data\\Output\\", year), collapse = "")
if (!(dir.exists(path))){
dir.create(path)
}
}
}
id <- 1
for (year in years) {
for (week in weeks) {
weekFile <- paste(c("..\\Data\\RMoreInformation\\", year, "\\week_", week, ".json"), collapse = "") # File with the information of the game
if (file.exists(weekFile)) {
resultWeek <- rjson::fromJSON(file = weekFile)
i <- 1 # For iteration purpose
for (game in resultWeek$games) {
game$comments <- numReplace(game$comments)
resultWeek$games[[i]]$comments <- game$comments
j <- 1
if (length(game$players) > 1){ # Games which doesn't have any players are filtered here
for (player in game$players) {
playerInformation <- player$`game information` # Get the detailed information of the player for this game
properties <- paste(names(playerInformation), playerInformation)
playerComment <- "" # All parts in the comment belonging to the player
for (tempCurrentPlayerOccurence in str_locate_all(game$comments, player$`player information`$name)) { # If a player occurs more than once in a comment, we have to find all belonging parts
firstOccurenceOfOtherPlayerInText <- str_length(game$comments) # Upper bound
for (playerTemp in game$players) { # For all players in the comment
playerOccurenceInText <- str_locate_all(game$comments, playerTemp$`player information`$name) # All occurences of the current player in the comment
for (occurenceIndex in playerOccurenceInText) {
if (firstOccurenceOfOtherPlayerInText > occurenceIndex[[1]] && occurenceIndex[[1]] > tempCurrentPlayerOccurence[[2]]) { # If the position of the temp player is between the current player and the current upper bound we change the upper bound
firstOccurenceOfOtherPlayerInText <- occurenceIndex[[1]] - 1 # Char position before the temp player
}
}
}
endOfPlayerSentence <- findFirstDotAfterPlayer(game$comments, tempCurrentPlayerOccurence[[2]])
if (endOfPlayerSentence > firstOccurenceOfOtherPlayerInText) {
firstOccurenceOfOtherPlayerInText <- endOfPlayerSentence
}
playerComment <- paste(c(playerComment, substr(game$comments, tempCurrentPlayerOccurence[[1]], firstOccurenceOfOtherPlayerInText)), collapse="") # The belonging comment part
}
numbers <- numExtract(playerComment) # Get numbers from text
# Check for each number if it occurs in the statistics of the player
for (number in numbers) {
for (property in properties) {
propertyName <- strsplit(property, "[[:space:]]")[[1]][1]
propertyValue <- strsplit(property, "[[:space:]]")[[1]][2]
if (number == propertyValue) {
if (number != 0) {
playerInformation[[propertyName]] <- list(propertyValue, id) # Add marker and unique ID for annotation, if match is found
names(playerInformation[[propertyName]]) <- c("propertyValue", "annotationID")
id <- id + 1
}
}
}
}
resultWeek$games[[i]]$players[[j]]$`game information` <- playerInformation
j <- j + 1
}
}
i <- i + 1
}
exportJSON <- rjson::toJSON(resultWeek, 1) # Generate JSON
fileName <- paste(c("..\\Data\\Output\\", year, "\\week_", week, ".json"), collapse = "")
write(exportJSON, fileName) # Save JSON to file
}
}
}
library(stringr)
library(rjson)
# Function extracts all numbers from given text
numExtract <- function(string) {
allNumbers <- regmatches(string, gregexpr("[[:digit:]]+", string))
allNumbers <- as.numeric(unlist(allNumbers))
allNumbers <- as.list(strsplit(toString(allNumbers), ", ")[[1]])
return(allNumbers)
}
#Replace all numbers (from one to ten) that occur as string as integer
numReplace <- function(text) {
numbersList <- list(
list(" one ", " 1 "),
list(" two ", " 2 "),
list(" three ", " 3 "),
list(" four ", " 4 "),
list(" five ", " 5 "),
list(" six ", " 6 "),
list(" seven ", " 7 "),
list(" eight ", " 8 "),
list(" nine ", " 9 "),
list(" ten ", " 10 "),
list("[(]one ", "(1 "),
list("[(]two ", "(2 "),
list("[(]three ", "(3 "),
list("[(]four ", "(4 "),
list("[(]five ", "(5 "),
list("[(]six ", "(6 "),
list("[(]seven ", "(7 "),
list("[(]eight ", "(8 "),
list("[(]nine ", "(9 "),
list("[(]ten ", "(10 "),
list(" one[)]", " 1)"),
list(" two[)]", " 2)"),
list(" three[)]", " 3)"),
list(" four[)]", " 4)"),
list(" five[)]", " 5)"),
list(" six[)]", " 6)"),
list(" seven[)]", " 7)"),
list(" eight[)]", " 8)"),
list(" nine[)]", " 9)"),
list(" ten[)]", " 10)"),
list(" one.", " 1."),
list(" two.", " 2."),
list(" three.", " 3."),
list(" four.", " 4."),
list(" five.", " 5."),
list(" six.", " 6."),
list(" seven.", " 7."),
list(" eight.", " 8."),
list(" nine.", " 9."),
list(" ten.", " 10."))
for (numberName in numbersList) {
text <- gsub(numberName[[1]], numberName[[2]], text)
}
return(text)
}
# Finds the first "." after the occurence of the player (the end of the sentence)
findFirstDotAfterPlayer <- function(comment, playerIndex) {
dotIndex <- str_length(comment) + 1 # Upper bound
for (dotOccurence in str_locate_all(comment, "[.]")[[1]]) {
if (dotOccurence[[1]] <= dotIndex && dotOccurence[[1]] >= playerIndex) {
dotIndex <- dotOccurence[[1]]
}
}
return(dotIndex)
}
weeks <- list("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20")
years <- list("2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017")
# Creating the Folders if not exists
path <- "..\\Data\\Output\\"
if (!(dir.exists(path))){
dir.create(path)
}
for (year in years) {
for (week in weeks) {
path <- paste(c("..\\Data\\Output\\", year), collapse = "")
if (!(dir.exists(path))){
dir.create(path)
}
}
}
id <- 1
for (year in years) {
for (week in weeks) {
weekFile <- paste(c("..\\Data\\RMoreInformation\\", year, "\\week_", week, ".json"), collapse = "") # File with the information of the game
if (file.exists(weekFile)) {
resultWeek <- rjson::fromJSON(file = weekFile)
i <- 1 # For iteration purpose
for (game in resultWeek$games) {
game$comments <- numReplace(game$comments)
resultWeek$games[[i]]$comments <- game$comments
j <- 1
if (length(game$players) > 1){ # Games which doesn't have any players are filtered here
for (player in game$players) {
playerInformation <- player$`game information` # Get the detailed information of the player for this game
properties <- paste(names(playerInformation), playerInformation)
playerComment <- "" # All parts in the comment belonging to the player
for (tempCurrentPlayerOccurence in str_locate_all(game$comments, player$`player information`$name)) { # If a player occurs more than once in a comment, we have to find all belonging parts
firstOccurenceOfOtherPlayerInText <- str_length(game$comments) # Upper bound
for (playerTemp in game$players) { # For all players in the comment
playerOccurenceInText <- str_locate_all(game$comments, playerTemp$`player information`$name) # All occurences of the current player in the comment
for (occurenceIndex in playerOccurenceInText) {
if (firstOccurenceOfOtherPlayerInText > occurenceIndex[[1]] && occurenceIndex[[1]] > tempCurrentPlayerOccurence[[2]]) { # If the position of the temp player is between the current player and the current upper bound we change the upper bound
firstOccurenceOfOtherPlayerInText <- occurenceIndex[[1]] - 1 # Char position before the temp player
}
}
}
endOfPlayerSentence <- findFirstDotAfterPlayer(game$comments, tempCurrentPlayerOccurence[[2]])
if (endOfPlayerSentence > firstOccurenceOfOtherPlayerInText) {
firstOccurenceOfOtherPlayerInText <- endOfPlayerSentence
}
playerComment <- paste(c(playerComment, substr(game$comments, tempCurrentPlayerOccurence[[1]], firstOccurenceOfOtherPlayerInText)), collapse="") # The belonging comment part
}
numbers <- numExtract(playerComment) # Get numbers from text
# Check for each number if it occurs in the statistics of the player
for (number in numbers) {
for (property in properties) {
propertyName <- strsplit(property, "[[:space:]]")[[1]][1]
propertyValue <- strsplit(property, "[[:space:]]")[[1]][2]
if (number == propertyValue) {
if (number != 0) {
playerInformation[[propertyName]] <- list(propertyValue, id) # Add marker and unique ID for annotation, if match is found
names(playerInformation[[propertyName]]) <- c("propertyValue", "annotationID")
id <- id + 1
}
}
}
}
resultWeek$games[[i]]$players[[j]]$`game information` <- playerInformation
j <- j + 1
}
}
i <- i + 1
}
exportJSON <- rjson::toJSON(resultWeek, 1) # Generate JSON
fileName <- paste(c("..\\Data\\Output\\", year, "\\week_", week, ".json"), collapse = "")
write(exportJSON, fileName) # Save JSON to file
}
}
}
